<div class="chat-container">
    <div class="chat-header">Chats</div>

    <div class="chat-messages" id="chat-messages">
        <div class="message-info">Operation Centre, 13:14</div>
        <div class="message message-bot">
            Hello John, unfortunately, we don't have that model in stock right now. A new order has been placed for it.
            <span class="message-time">13:14</span>
        </div>
        <div class="clearfix"></div>

        <div class="message message-user">
            Hi, I've checked the installation and found that the check valve is cracked. We'll need a new one. The model is V-00025314
            <span class="message-time">13:15</span>
        </div>
        <div class="clearfix"></div>

        <div class="message message-user">
            Do you know when the order will arrive?
            <span class="message-time">13:15</span>
        </div>
        <div class="clearfix"></div>

        <div class="message-info">Operation Centre, 13:16</div>
        <div class="message message-bot">
            The new check valve is expected to arrive in about a week.
            <span class="message-time">13:16</span>
        </div>
        <div class="clearfix"></div>

        <div class="message message-user">
            Got it, thanks. I'll open a new work order for a week from now.
            <span class="message-time">13:17</span>
        </div>
        <div class="clearfix"></div>
    </div>

    <div class="chat-input">
        <button class="attachment-button">
            <i class="material-icons">attach_file</i>
        </button>
        <input type="text" id="message-input" placeholder="Type a message">
        <button class="send-button" id="send-button">
            <i class="material-icons" style="color: white;">send</i>
        </button>
    </div>
</div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function addUserMessage(message) {
            const div = document.createElement('div');
            div.className = 'message message-user';
            div.innerHTML = `
                ${message}
                <span class="message-time">${getCurrentTime()}</span>
            `;
            chatMessages.appendChild(div);
            const clearfix = document.createElement('div');
            clearfix.className = 'clearfix';
            chatMessages.appendChild(clearfix);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addBotMessage(message) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'message-info';
            infoDiv.textContent = `AI Bot, ${getCurrentTime()}`;
            chatMessages.appendChild(infoDiv);
            const div = document.createElement('div');
            div.className = 'message message-bot';
            div.innerHTML = `
                ${message}
                <span class="message-time">${getCurrentTime()}</span>
            `;
            chatMessages.appendChild(div);
            const clearfix = document.createElement('div');
            clearfix.className = 'clearfix';
            chatMessages.appendChild(clearfix);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                addUserMessage(message);
                messageInput.value = '';
                // Send to backend
                const response = await fetch('/Chat/SendMessage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                const data = await response.json();
                addBotMessage(data.response);
            }
        }

        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        messageInput.focus();
    });
</script>

<style>
body.dark-mode .chat-container {
    background: #18191a !important;
    color: #f1f1f1 !important;
}
body.dark-mode .chat-header {
    background: #222 !important;
    color: #fff !important;
    border-bottom: 1px solid #333 !important;
}
body.dark-mode .chat-messages {
    background: #222 !important;
    color: #fff !important;
}
body.dark-mode .message.message-user {
    background: #6366f1 !important;
    color: #fff !important;
}
body.dark-mode .message.message-bot {
    background: #333 !important;
    color: #fff !important;
}
body.dark-mode .message-info {
    color: #aaa !important;
}
body.dark-mode .chat-input {
    background: #18191a !important;
    border-top: 1px solid #333 !important;
}
body.dark-mode .form-control, body.dark-mode input[type="text"] {
    background: #222 !important;
    color: #fff !important;
    border-color: #444 !important;
}
body.dark-mode .send-button {
    background: #6366f1 !important;
    color: #fff !important;
}
body.dark-mode .send-button:hover {
    background: #4f46e5 !important;
}
body.dark-mode .attachment-button {
    background: #222 !important;
    color: #fff !important;
}
</style>
