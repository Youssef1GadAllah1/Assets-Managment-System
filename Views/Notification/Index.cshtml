@model IEnumerable<Capstone_Next_Step.Models.Notification>

<div class="notifications">
    <div class="notifications-header">Notifications</div>

    @if (!Model.Any())
    {
        <div class="text-muted">No notifications</div>
    }
    else
    {
        foreach (var n in Model)
        {
            var itemClass = n.IsRead ? "notification-item" : "notification-item";
            <a class="text-decoration-none" href="@(n.LinkUrl ?? "#")" data-id="@n.Id">
                <div class="@itemClass">
                    <div class="notification-time">@n.CreatedAt.ToLocalTime().ToString("g")</div>
                    <div class="notification-content"><strong>@n.Title</strong> - @n.Message</div>
                </div>
            </a>
        }
    }
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.notifications a[data-id]').forEach(function(row) {
    row.addEventListener('click', function(e) {
      const id = this.getAttribute('data-id');
      fetch('/Notification/MarkAsRead', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `notificationId=${id}`
      }).then(() => {
        // Optimistically hide badge if exists
        const badge = document.querySelector('.notification-badge .badge');
        if (badge) {
          const val = Math.max(0, (parseInt(badge.textContent || '0') || 0) - 1);
          badge.textContent = val;
          if (val === 0) badge.style.display = 'none';
        }
      });
    });
  });
});
</script>